<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cart</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.5/dist/css/bootstrap.min.css" rel="stylesheet"/>
 <link rel="stylesheet" href="./styles.css">
 <link rel="stylesheet" href="./Mediaqueries.css">
 
 <style>
    img.product-img {
      width: 80px;
      height: 80px;
      object-fit: contain;
      border-radius: 8px;
    }
    .cart-item {
      background: #f3f0f0;
      border-radius: 10px;
    }
    .quantity-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      font-weight: bold;
      cursor: pointer;
    }
    .quantity-btn:hover {
      color: darkred;
    }
  </style>
</head>
<body class="container border shadow-lg">
  <header>
    <input
      type="checkbox"
      id="toggle"
      placeholder="Search..."
      class="search-bar"
    />
    <label for="toggle" class="Threelineicon">&#9776;</label>
    <div><strong class="fs-4">Ecommerce</strong></div>

    <nav>
      <a href="./index.html">Home</a>
      <a href="./product.html">Products</a>
      <a href="./aboutUs.html">About</a>
      <a href="./contactUs.html">Contact</a>
    </nav>
    <div class="nav-buttons">
      <a href="./login.html"
        ><button class="btn btn-outline-dark" id="Login">
          <i class="fas fa-sign-in-alt"></i>Login
        </button></a
      >
      <a href="./Register.html"
        ><button class="btn btn-outline-dark" id="Register">
          <i class="fas fa-user-plus"></i>Register
        </button></a
      >
      <a href="./Cart.html"
        ><button class="btn btn-outline-dark" id="Cart">
          <i class="fas fa-shopping-cart"></i>Cart(0)
        </button></a
      >
    </div>
  </header>
  <h2 class="section-title pb-3 border-bottom ms-5 me-5 m">Cart</h2>

  <div class="row px-5 " id="maincart">
    <div class="col-md-8 border rounded">
      <h5 class="border-bottom p-3 rounded">Item List</h5>
      <div id="product"></div>
    </div>
    <div class="col-md-4">
      <div id="summary" class="m-3"></div>
    </div>
  </div>

  <footer class="text-center my-4">Made with ❤️ by SHIVA V.</footer>
  <script>// load cart data from localStorage
    let cartData = JSON.parse(localStorage.getItem("trendmall")) || [];
    if (!Array.isArray(cartData)) cartData = [cartData];
    cartData = cartData.map((item) => ({ ...item, quantity: item.quantity || 1 }));
    
    // COMBINE DUPLICATES based on product id (or title if no id)
    let combinedCartData = [];
    
    cartData.forEach((item) => {
      const existingItem = combinedCartData.find(
        (product) => product.id === item.id // assuming "id" is unique for a product
      );
      if (existingItem) {
        existingItem.quantity += item.quantity;
      } else {
        combinedCartData.push({ ...item });
      }
    });
    
    cartData = combinedCartData;
    console.log( combinedCartData.length);
    
    
    const productContainer = document.getElementById("product");
    let maincart = document.getElementById("maincart");
    
    // check if cart is empty
    if (cartData.length === 0) {
      maincart.innerHTML = `
        <div class="text-center mb-5 p-4 bg-light">
          <h2>Your Cart is Empty</h2>
          <a href="./product.html" class="btn btn-outline-dark mt-3">
            <i class="fas fa-arrow-left"></i> Continue Shopping
          </a>
        </div>
      `;
    }
    
    // update cart count
    
    // update summary
    function updateSummary() {
      const summaryBox = document.getElementById("summary");
      let totalQuantity = 0,
        totalPrice = 0,
        shipping = 30;
      cartData.forEach((i) => {
        totalQuantity += i.quantity;
        totalPrice += i.price * i.quantity;
      });
      summaryBox.innerHTML = `
        <div class="card shadow-sm p-3">
          <h5 class="border-bottom pb-2">Order Summary</h5>
          <p>Products (${totalQuantity})<span class="float-end">$${totalPrice.toFixed(2)}</span></p>
          <p>Shipping<span class="float-end">$${shipping.toFixed(2)}</span></p>
          <p class="fw-bold">Total Amount<span class="float-end">$${(totalPrice + shipping).toFixed(2)}</span></p>
          <button class="btn btn-dark w-100 mt-2">Go to checkout</button>
        </div>
      `;
    }
    
    // render products
    function renderCartItems() {
      productContainer.innerHTML = "";
    
      if (cartData.length === 0) {
        maincart.innerHTML = `
          <div class="text-center mb-5 p-4 bg-light">
            <h2>Your Cart is Empty</h2>
            <a href="./product.html" class="btn btn-outline-dark mt-3">
              <i class="fas fa-arrow-left"></i> Continue Shopping
            </a>
          </div>
        `;
        return;
      }
    
      cartData.forEach((item, idx) => {
        const div = document.createElement("div");
        div.className = "cart-item shadow-sm";
        div.innerHTML = `
        <div class="d-flex gap-3 mb-4 align-items-start">
          
          <!-- Product Image -->
          <img src="${item.image}" alt="${item.title}" 
               class="product-img rounded" 
               style="width: 80px; height: auto; flex-shrink: 0;">
          
          <!-- Product Details -->
          <div class="flex-grow-1">
            <!-- Product Title -->
            <h6 class="fw-semibold text-break mb-1">${item.title}</h6>
            
            <!-- Quantity Controls -->
            <div class="d-flex align-items-center gap-2 mb-1">
              <button class="bg-transparent border-0 fw-bold fs-5" onclick="changeQuantity(${idx}, -1)">−</button>
              <span class="fw-bold">${item.quantity}</span>
              <button class="bg-transparent border-0 fw-bold fs-5" onclick="changeQuantity(${idx}, 1)">+</button>
            </div>
            
            <!-- Price Line -->
            <div class="text-muted">
              ${item.quantity} × $${item.price.toFixed(2)}
            </div>
          </div>
          
        </div>
      `;
      
        productContainer.appendChild(div);
      });
      updateSummary();
      localStorage.setItem("trendmall", JSON.stringify(cartData));
    }
    
    // change quantity
    function changeQuantity(index, delta) {
      cartData[index].quantity += delta;
      if (cartData[index].quantity <= 0) {
        cartData.splice(index, 1);
      }
      renderCartItems();
    }
    
    // initial render
    renderCartItems();
    // update the cart value
    const cartCount = document.getElementById("Cart");
    cartCount.innerHTML = `<i class="fas fa-shopping-cart"></i>Cart(${combinedCartData.length})`;</script>
</body>
</html>